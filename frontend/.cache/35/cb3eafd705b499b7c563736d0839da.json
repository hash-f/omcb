{"id":"node_modules/react-use-websocket/dist/lib/use-websocket.js","dependencies":[{"name":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react-use-websocket/dist/lib/use-websocket.js.map","includedInParent":true,"mtime":1732535186176},{"name":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react-use-websocket/src/lib/use-websocket.ts","includedInParent":true,"mtime":1732535186181},{"name":"/Users/h/Developer/go-by-example/omcb/frontend/package.json","includedInParent":true,"mtime":1732535186185},{"name":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react-use-websocket/package.json","includedInParent":true,"mtime":1732535186173},{"name":"react","loc":{"line":54,"column":22,"index":3239},"parent":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react-use-websocket/dist/lib/use-websocket.js","resolved":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react/index.js"},{"name":"react-dom","loc":{"line":55,"column":26,"index":3275},"parent":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react-use-websocket/dist/lib/use-websocket.js","resolved":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react-dom/index.js"},{"name":"./constants","loc":{"line":56,"column":26,"index":3315},"parent":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react-use-websocket/dist/lib/use-websocket.js","resolved":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react-use-websocket/dist/lib/constants.js"},{"name":"./create-or-join","loc":{"line":57,"column":31,"index":3362},"parent":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react-use-websocket/dist/lib/use-websocket.js","resolved":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react-use-websocket/dist/lib/create-or-join.js"},{"name":"./get-url","loc":{"line":58,"column":24,"index":3407},"parent":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react-use-websocket/dist/lib/use-websocket.js","resolved":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react-use-websocket/dist/lib/get-url.js"},{"name":"./proxy","loc":{"line":59,"column":38,"index":3459},"parent":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react-use-websocket/dist/lib/use-websocket.js","resolved":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react-use-websocket/dist/lib/proxy.js"},{"name":"./util","loc":{"line":60,"column":21,"index":3493},"parent":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react-use-websocket/dist/lib/use-websocket.js","resolved":"/Users/h/Developer/go-by-example/omcb/frontend/node_modules/react-use-websocket/dist/lib/util.js"}],"generated":{"js":"\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.useWebSocket = void 0;\nvar react_1 = require(\"react\");\nvar react_dom_1 = require(\"react-dom\");\nvar constants_1 = require(\"./constants\");\nvar create_or_join_1 = require(\"./create-or-join\");\nvar get_url_1 = require(\"./get-url\");\nvar proxy_1 = __importDefault(require(\"./proxy\"));\nvar util_1 = require(\"./util\");\nvar useWebSocket = function (url, options, connect) {\n    if (options === void 0) { options = constants_1.DEFAULT_OPTIONS; }\n    if (connect === void 0) { connect = true; }\n    var _a = (0, react_1.useState)(null), lastMessage = _a[0], setLastMessage = _a[1];\n    var _b = (0, react_1.useState)({}), readyState = _b[0], setReadyState = _b[1];\n    var lastJsonMessage = (0, react_1.useMemo)(function () {\n        if (lastMessage) {\n            try {\n                return JSON.parse(lastMessage.data);\n            }\n            catch (e) {\n                return constants_1.UNPARSABLE_JSON_OBJECT;\n            }\n        }\n        return null;\n    }, [lastMessage]);\n    var convertedUrl = (0, react_1.useRef)(null);\n    var webSocketRef = (0, react_1.useRef)(null);\n    var startRef = (0, react_1.useRef)(function () { return void 0; });\n    var reconnectCount = (0, react_1.useRef)(0);\n    var lastMessageTime = (0, react_1.useRef)(Date.now());\n    var messageQueue = (0, react_1.useRef)([]);\n    var webSocketProxy = (0, react_1.useRef)(null);\n    var optionsCache = (0, react_1.useRef)(options);\n    optionsCache.current = options;\n    var readyStateFromUrl = convertedUrl.current && readyState[convertedUrl.current] !== undefined ?\n        readyState[convertedUrl.current] :\n        url !== null && connect === true ?\n            constants_1.ReadyState.CONNECTING :\n            constants_1.ReadyState.UNINSTANTIATED;\n    var stringifiedQueryParams = options.queryParams ? JSON.stringify(options.queryParams) : null;\n    var sendMessage = (0, react_1.useCallback)(function (message, keep) {\n        var _a;\n        if (keep === void 0) { keep = true; }\n        if (constants_1.isEventSourceSupported && webSocketRef.current instanceof EventSource) {\n            console.warn('Unable to send a message from an eventSource');\n            return;\n        }\n        if (((_a = webSocketRef.current) === null || _a === void 0 ? void 0 : _a.readyState) === constants_1.ReadyState.OPEN) {\n            (0, util_1.assertIsWebSocket)(webSocketRef.current, optionsCache.current.skipAssert);\n            webSocketRef.current.send(message);\n        }\n        else if (keep) {\n            messageQueue.current.push(message);\n        }\n    }, []);\n    var sendJsonMessage = (0, react_1.useCallback)(function (message, keep) {\n        if (keep === void 0) { keep = true; }\n        sendMessage(JSON.stringify(message), keep);\n    }, [sendMessage]);\n    var getWebSocket = (0, react_1.useCallback)(function () {\n        if (optionsCache.current.share !== true || (constants_1.isEventSourceSupported && webSocketRef.current instanceof EventSource)) {\n            return webSocketRef.current;\n        }\n        if (webSocketProxy.current === null && webSocketRef.current) {\n            (0, util_1.assertIsWebSocket)(webSocketRef.current, optionsCache.current.skipAssert);\n            webSocketProxy.current = (0, proxy_1.default)(webSocketRef.current, startRef);\n        }\n        return webSocketProxy.current;\n    }, []);\n    (0, react_1.useEffect)(function () {\n        if (url !== null && connect === true) {\n            var removeListeners_1;\n            var expectClose_1 = false;\n            var createOrJoin_1 = true;\n            var start_1 = function () { return __awaiter(void 0, void 0, void 0, function () {\n                var _a, protectedSetLastMessage, protectedSetReadyState;\n                return __generator(this, function (_b) {\n                    switch (_b.label) {\n                        case 0:\n                            _a = convertedUrl;\n                            return [4 /*yield*/, (0, get_url_1.getUrl)(url, optionsCache)];\n                        case 1:\n                            _a.current = _b.sent();\n                            if (convertedUrl.current === null) {\n                                console.error('Failed to get a valid URL. WebSocket connection aborted.');\n                                convertedUrl.current = 'ABORTED';\n                                (0, react_dom_1.flushSync)(function () { return setReadyState(function (prev) { return (__assign(__assign({}, prev), { ABORTED: constants_1.ReadyState.CLOSED })); }); });\n                                return [2 /*return*/];\n                            }\n                            protectedSetLastMessage = function (message) {\n                                if (!expectClose_1) {\n                                    (0, react_dom_1.flushSync)(function () { return setLastMessage(message); });\n                                }\n                            };\n                            protectedSetReadyState = function (state) {\n                                if (!expectClose_1) {\n                                    (0, react_dom_1.flushSync)(function () { return setReadyState(function (prev) {\n                                        var _a;\n                                        return (__assign(__assign({}, prev), (convertedUrl.current && (_a = {}, _a[convertedUrl.current] = state, _a))));\n                                    }); });\n                                }\n                            };\n                            if (createOrJoin_1) {\n                                removeListeners_1 = (0, create_or_join_1.createOrJoinSocket)(webSocketRef, convertedUrl.current, protectedSetReadyState, optionsCache, protectedSetLastMessage, startRef, reconnectCount, lastMessageTime, sendMessage);\n                            }\n                            return [2 /*return*/];\n                    }\n                });\n            }); };\n            startRef.current = function () {\n                if (!expectClose_1) {\n                    if (webSocketProxy.current)\n                        webSocketProxy.current = null;\n                    removeListeners_1 === null || removeListeners_1 === void 0 ? void 0 : removeListeners_1();\n                    start_1();\n                }\n            };\n            start_1();\n            return function () {\n                expectClose_1 = true;\n                createOrJoin_1 = false;\n                if (webSocketProxy.current)\n                    webSocketProxy.current = null;\n                removeListeners_1 === null || removeListeners_1 === void 0 ? void 0 : removeListeners_1();\n                setLastMessage(null);\n            };\n        }\n        else if (url === null || connect === false) {\n            reconnectCount.current = 0; // reset reconnection attempts\n            setReadyState(function (prev) {\n                var _a;\n                return (__assign(__assign({}, prev), (convertedUrl.current && (_a = {}, _a[convertedUrl.current] = constants_1.ReadyState.CLOSED, _a))));\n            });\n        }\n    }, [url, connect, stringifiedQueryParams, sendMessage]);\n    (0, react_1.useEffect)(function () {\n        if (readyStateFromUrl === constants_1.ReadyState.OPEN) {\n            messageQueue.current.splice(0).forEach(function (message) {\n                sendMessage(message);\n            });\n        }\n    }, [readyStateFromUrl]);\n    return {\n        sendMessage: sendMessage,\n        sendJsonMessage: sendJsonMessage,\n        lastMessage: lastMessage,\n        lastJsonMessage: lastJsonMessage,\n        readyState: readyStateFromUrl,\n        getWebSocket: getWebSocket,\n    };\n};\nexports.useWebSocket = useWebSocket;\n"},"sourceMaps":{"js":{"version":3,"file":"use-websocket.js","sourceRoot":"","sources":["../../src/lib/use-websocket.ts"],"names":[],"mappings":"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","sourcesContent":["import { useEffect, useRef, useState, useCallback, useMemo } from 'react';\nimport { flushSync } from 'react-dom';\nimport { DEFAULT_OPTIONS, isEventSourceSupported, ReadyState, UNPARSABLE_JSON_OBJECT } from './constants';\nimport { createOrJoinSocket } from './create-or-join';\nimport { getUrl } from './get-url';\nimport websocketWrapper from './proxy';\nimport {\n  Options,\n  ReadyStateState,\n  SendMessage,\n  SendJsonMessage,\n  WebSocketMessage,\n  WebSocketHook,\n  WebSocketLike,\n} from './types';\nimport { assertIsWebSocket } from './util';\n\nexport const useWebSocket = <T = unknown>(\n  url: string | (() => string | Promise<string>) | null,\n  options: Options = DEFAULT_OPTIONS,\n  connect: boolean = true,\n): WebSocketHook<T> => {\n  const [lastMessage, setLastMessage] = useState<WebSocketEventMap['message'] | null>(null);\n  const [readyState, setReadyState] = useState<ReadyStateState>({});\n  const lastJsonMessage: T = useMemo(() => {\n    if (lastMessage) {\n      try {\n        return JSON.parse(lastMessage.data);\n      } catch (e) {\n        return UNPARSABLE_JSON_OBJECT;\n      }\n    }\n    return null;\n  }, [lastMessage]);\n  const convertedUrl = useRef<string | null>(null);\n  const webSocketRef = useRef<WebSocketLike | null>(null);\n  const startRef = useRef<() => void>(() => void 0);\n  const reconnectCount = useRef<number>(0);\n  const lastMessageTime = useRef<number>(Date.now());\n  const messageQueue = useRef<WebSocketMessage[]>([]);\n  const webSocketProxy = useRef<WebSocketLike | null>(null);\n  const optionsCache = useRef<Options>(options);\n  optionsCache.current = options;\n\n  const readyStateFromUrl: ReadyState =\n    convertedUrl.current && readyState[convertedUrl.current] !== undefined ?\n      readyState[convertedUrl.current] :\n      url !== null && connect === true ?\n        ReadyState.CONNECTING :\n        ReadyState.UNINSTANTIATED;\n\n  const stringifiedQueryParams = options.queryParams ? JSON.stringify(options.queryParams) : null;\n\n  const sendMessage: SendMessage = useCallback((message, keep = true) => {\n    if (isEventSourceSupported && webSocketRef.current instanceof EventSource) {\n      console.warn('Unable to send a message from an eventSource');\n      return;\n    }\n\n    if (webSocketRef.current?.readyState === ReadyState.OPEN) {\n      assertIsWebSocket(webSocketRef.current, optionsCache.current.skipAssert);\n      webSocketRef.current.send(message);\n    } else if (keep) {\n      messageQueue.current.push(message);\n    }\n  }, []);\n\n  const sendJsonMessage: SendJsonMessage = useCallback((message, keep = true) => {\n    sendMessage(JSON.stringify(message), keep);\n  }, [sendMessage]);\n\n  const getWebSocket = useCallback(() => {\n    if (optionsCache.current.share !== true || (isEventSourceSupported && webSocketRef.current instanceof EventSource)) {\n      return webSocketRef.current;\n    }\n\n    if (webSocketProxy.current === null && webSocketRef.current) {\n      assertIsWebSocket(webSocketRef.current, optionsCache.current.skipAssert);\n      webSocketProxy.current = websocketWrapper(webSocketRef.current, startRef);\n    }\n\n    return webSocketProxy.current;\n  }, []);\n\n  useEffect(() => {\n    if (url !== null && connect === true) {\n      let removeListeners: () => void;\n      let expectClose = false;\n      let createOrJoin = true;\n\n      const start = async () => {\n        convertedUrl.current = await getUrl(url, optionsCache);\n\n        if (convertedUrl.current === null) {\n          console.error('Failed to get a valid URL. WebSocket connection aborted.');\n          convertedUrl.current = 'ABORTED';\n          flushSync(() => setReadyState(prev => ({\n            ...prev,\n            ABORTED: ReadyState.CLOSED,\n          })));\n\n          return;\n        }\n\n        const protectedSetLastMessage = (message: WebSocketEventMap['message']) => {\n          if (!expectClose) {\n            flushSync(() => setLastMessage(message));\n          }\n        };\n\n        const protectedSetReadyState = (state: ReadyState) => {\n          if (!expectClose) {\n            flushSync(() => setReadyState(prev => ({\n              ...prev,\n              ...(convertedUrl.current && { [convertedUrl.current]: state }),\n            })));\n          }\n        };\n\n        if (createOrJoin) {\n          removeListeners = createOrJoinSocket(\n            webSocketRef,\n            convertedUrl.current,\n            protectedSetReadyState,\n            optionsCache,\n            protectedSetLastMessage,\n            startRef,\n            reconnectCount,\n            lastMessageTime,\n            sendMessage,\n          );\n        }\n      };\n\n      startRef.current = () => {\n        if (!expectClose) {\n          if (webSocketProxy.current) webSocketProxy.current = null;\n          removeListeners?.();\n          start();\n        }\n      };\n\n      start();\n      return () => {\n        expectClose = true;\n        createOrJoin = false;\n        if (webSocketProxy.current) webSocketProxy.current = null;\n        removeListeners?.();\n        setLastMessage(null);\n      };\n    } else if (url === null || connect === false) {\n      reconnectCount.current = 0; // reset reconnection attempts\n      setReadyState(prev => ({\n        ...prev,\n        ...(convertedUrl.current && { [convertedUrl.current]: ReadyState.CLOSED }),\n      }));\n    }\n  }, [url, connect, stringifiedQueryParams, sendMessage]);\n\n  useEffect(() => {\n    if (readyStateFromUrl === ReadyState.OPEN) {\n      messageQueue.current.splice(0).forEach(message => {\n        sendMessage(message);\n      });\n    }\n  }, [readyStateFromUrl]);\n\n  return {\n    sendMessage,\n    sendJsonMessage,\n    lastMessage,\n    lastJsonMessage,\n    readyState: readyStateFromUrl,\n    getWebSocket,\n  };\n};\n"]}},"error":null,"hash":"4191a368e66d9379f349094eb17286eb","cacheData":{"env":{}}}